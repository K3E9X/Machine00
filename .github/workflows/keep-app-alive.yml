name: Keep Streamlit App Alive

on:
  schedule:
    # Ping l'app tous les jours Ã  8h UTC (9h Paris hiver, 10h Paris Ã©tÃ©)
    - cron: '0 8 * * *'
    # Ping Ã©galement tous les 3 jours Ã  14h UTC pour sÃ©curitÃ©
    - cron: '0 14 */3 * *'

  # Permet de lancer manuellement le workflow
  workflow_dispatch:

jobs:
  ping-app:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Streamlit App
        run: |
          echo "ğŸ”” Pinging app at $(date)"
          response=$(curl -I -s -w "\n%{http_code}" https://app-security-audit.streamlit.app/)
          status_code=$(echo "$response" | tail -n 1)

          echo "ğŸ“Š HTTP Status: $status_code"

          if [ "$status_code" = "200" ]; then
            echo "âœ… App is alive and responding!"
          else
            echo "âš ï¸ App returned status code: $status_code"
            echo "This might be normal if the app is waking up"
          fi

      - name: Send notification
        run: |
          echo "ğŸ‰ Keep-alive ping completed at $(date)"
          echo "Next ping scheduled in cron schedule"
